{% extends 'operator/base_operator.html' %}

{% block content %}
<div class="search-results">
    <h2>üîç –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞</h2>

    <div style="margin-bottom: 25px;">
        <a href="{% url 'operator_dashboard' %}" class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É –∑–∞—è–≤–æ–∫</a>
    </div>

    <div class="search-section">
        <form method="get" action="{% url 'search_leads' %}">
            <input type="text" name="q" placeholder="–ü–æ–∏—Å–∫ –ø–æ –§–ò–û, —Ç–µ–ª–µ—Ñ–æ–Ω—É –∏–ª–∏ –∞–¥—Ä–µ—Å—É..." value="{{ query }}" style="padding: 12px; width: 300px;">
            <button type="submit" class="btn btn-primary">üîç –ò—Å–∫–∞—Ç—å</button>
        </form>
    </div>

    {% if query %}
        <div class="results-info">
            <p>–ù–∞–π–¥–µ–Ω–æ –∑–∞—è–≤–æ–∫: <strong>{{ leads.count }}</strong></p>
            <p>–ü–æ –∑–∞–ø—Ä–æ—Å—É: <strong>"{{ query }}"</strong></p>
        </div>

        {% if leads %}
            <div class="leads-section">
                {% for lead in leads %}
                    <div class="lead-card">
                        <p><strong>üë§ {{ lead.fio }}</strong></p>
                        <p>üìû {{ lead.phone }}</p>
                        <p>üè† {{ lead.address }}</p>
                        <p>üìç –†–µ–≥–∏–æ–Ω: {{ lead.region }}</p>
                        <p>üí´ –¢–∞—Ä–∏—Ñ: {{ lead.tariff.name }} - {{ lead.tariff.price }} ‚ÇΩ/–º–µ—Å</p>
                        <p>üìä –°—Ç–∞—Ç—É—Å: <span style="color:
                            {% if lead.status == 'new' %}var(--rt-purple)
                            {% elif lead.status == 'repeated' %}var(--rt-orange)
                            {% elif lead.status == 'transferred' %}var(--rt-green)
                            {% else %}#666{% endif %}; font-weight: 600;">
                            {{ lead.get_status_display }}
                        </span></p>
                        <p>‚è∞ –°–æ–∑–¥–∞–Ω–∞: {{ lead.created_at|date:"d.m.Y H:i" }}</p>

                        <div class="actions">
                            {% if lead.status == 'new' %}
                                <a href="{% url 'take_lead' lead.id %}" class="btn btn-success">
                                    ‚úèÔ∏è –í–∑—è—Ç—å –≤ —Ä–∞–±–æ—Ç—É
                                </a>
                            {% else %}
                                <a href="{% url 'view_lead' lead.id %}" class="btn btn-secondary">
                                    üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä
                                </a>
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="no-results">
                <p>üòî –ü–æ –∑–∞–ø—Ä–æ—Å—É "{{ query }}" –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>
                <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å</p>
            </div>
        {% endif %}
    {% else %}
        <div class="no-query">
            <p>üîç –í–≤–µ–¥–∏—Ç–µ –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –≤ –ø–æ–ª–µ –≤—ã—à–µ</p>
            <p>–ü–æ–∏—Å–∫ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ: –§–ò–û, —Ç–µ–ª–µ—Ñ–æ–Ω—É, –∞–¥—Ä–µ—Å—É –∏ –ø—Ä–∏–º–µ—á–∞–Ω–∏—è–º</p>
        </div>
    {% endif %}
</div>

<style>
.search-results {
    max-width: 1000px;
    margin: 0 auto;
}

.search-section {
    margin-bottom: 30px;
    padding: 20px;
    background: var(--rt-white);
    border-radius: var(--border-radius);
    box-shadow: var(--shadow);
}

.results-info {
    background: var(--rt-cool-grey);
    padding: 15px;
    border-radius: var(--border-radius);
    margin-bottom: 20px;
}

.no-results, .no-query {
    text-align: center;
    padding: 40px;
    background: var(--rt-white);
    border-radius: var(--border-radius);
    box-shadow: var(--shadow);
    color: var(--rt-black);
    opacity: 0.8;
}

.lead-card {
    background: var(--rt-white);
    border: 2px solid var(--rt-lavender);
    border-radius: var(--border-radius);
    padding: 20px;
    margin: 15px 0;
    transition: all 0.3s ease;
}

.lead-card:hover {
    border-color: var(--rt-purple);
    transform: translateY(-2px);
    box-shadow: var(--shadow);
}

.actions {
    margin-top: 15px;
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}
</style>
{% endblock %}