{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>RT Интернет - Официальный дилер Ростелекома</title>
  <meta name="description" content="Официальный дилер Ростелекома. Подключите высокоскоростной интернет, телевидение и мобильную связь.">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="{% static 'tariffs/css/style.css' %}">
  <link rel="icon" href="{% static 'tariffs/images/logos/favicon.ico' %}" type="image/x-icon">

</head>
<body>
<header>
  <div class="container">
    <div class="header-content">
      <div class="logo">
        <img src="{% static 'tariffs/images/logos/logo-purple.svg' %}" alt="Ростелеком" class="rt-logo">
        <!-- <span class="site-name">RT Интернет</span> -->
      </div>
      <div class="region-selector">
        <i class="fas fa-map-marker-alt"></i>
        <span class="current-region">
          {% if current_region %}
            {{ current_region.name }}
          {% else %}
            Все регионы
          {% endif %}
        </span>

        {% if regions %}
        <div class="region-dropdown">
          <button class="dropdown-btn">
            <i class="fas fa-chevron-down"></i>
          </button>
          <div class="dropdown-content">
            {% if current_region %}
              <a href="http://localhost:8000" class="dropdown-item">
                <i class="fas fa-globe"></i> Все регионы
              </a>
            {% endif %}
            {% for region in regions %}
              {% if region.subdomain and region != current_region %}
                <a href="http://{{ region.subdomain }}.localhost:8000" class="dropdown-item">
                  <i class="fas fa-city"></i> {{ region.name }}
                </a>
              {% endif %}
            {% endfor %}
          </div>
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</header>

<section class="hero">
  <div class="container">
    <h2>Высокоскоростной интернет от Ростелекома</h2>
    <p>Официальный дилер. Подключите один из наших тарифов и получите стабильный интернет с бесплатной установкой</p>
  </div>
</section>

<section class="features">
  <div class="container">
    <h2 class="section-title">Почему выбирают Ростелеком</h2>
    <div class="features-grid">
      <div class="feature-card fade-in">
        <i class="fas fa-bolt"></i>
        <h3>Высокая скорость</h3>
        <p>До 1 Гбит/с без ограничений и throttling</p>
      </div>
      <div class="feature-card fade-in">
        <i class="fas fa-shield-alt"></i>
        <h3>Надежность</h3>
        <p>99.9% uptime и круглосуточная поддержка</p>
      </div>
      <div class="feature-card fade-in">
        <i class="fas fa-tools"></i>
        <h3>Бесплатная установка</h3>
        <p>Профессиональный монтаж и настройка оборудования</p>
      </div>
      <div class="feature-card fade-in">
        <i class="fas fa-headset"></i>
        <h3>Поддержка 24/7</h3>
        <p>Техническая поддержка работает круглосуточно</p>
      </div>
    </div>
  </div>
</section>

<section class="tariffs">
  <div class="container">
    <h2 class="section-title">Тарифы Ростелекома</h2>

    {% if current_region %}
    <div class="region-info">
      <h3>Тарифы для {{ current_region.name }}</h3>
      <p>Подключение доступно по всему региону</p>
    </div>
    {% endif %}

    <div class="filter-buttons">
      <button class="filter-btn active" data-speed="">Все тарифы</button>
      <button class="filter-btn" data-speed="100">До 100 Мбит/с</button>
      <button class="filter-btn" data-speed="300">До 300 Мбит/с</button>
      <button class="filter-btn" data-speed="500">Выше 500 Мбит/с</button>
    </div>

    <!-- Карусель тарифов -->
    <div class="rt-carousel-container">
      <div class="rt-carousel-wrapper">
        <div id="rt-tariff-carousel" class="rt-carousel">
          {% for tariff in tariffs %}
          {% with speed_value=tariff.speed|default:"0"|cut:"Мбит/с"|cut:" "|cut:"Мбит" %}
          <div class="rt-carousel-item" data-speed="{{ speed_value }}">
            <div class="rt-tariff-card">
              <div class="rt-tariff">
                <div class="card-title">{{ tariff.name }}</div>

                <div class="rt-tariff__offers">
                  <!-- Интернет -->
                  <div class="rt-tariff__offer">
                    <div class="enabled Main_Internet_service">
                      <div class="rt-tariff-option">
                        <i class="rt-tariff-option__icon">
                          <svg class="rt-sys-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" d="M15.04 19.94a8.507 8.507 0 005.427-7.19h-3.48c-.11 2.928-.848 5.505-1.947 7.19zM12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10zM8.96 4.06a8.507 8.507 0 00-5.427 7.19h3.48c.11-2.928.848-5.505 1.947-7.19zm-.445 7.19c.09-2.266.587-4.243 1.291-5.65.825-1.65 1.688-2.1 2.194-2.1.507 0 1.369.45 2.194 2.1.704 1.407 1.2 3.384 1.291 5.65h-6.97zm0 1.5c.09 2.266.587 4.243 1.291 5.65.825 1.65 1.688 2.1 2.194 2.1.507 0 1.369-.45 2.194-2.1.704-1.407 1.2-3.384 1.291-5.65h-6.97zm-1.501 0c.108 2.928.847 5.505 1.946 7.19a8.507 8.507 0 01-5.427-7.19h3.48zm9.972-1.5c-.108-2.928-.847-5.505-1.946-7.19a8.507 8.507 0 015.427 7.19h-3.48z" clip-rule="evenodd"></path>
                          </svg>
                        </i>
                        <div class="rt-tariff-option__info">
                          <div class="rt-tariff-option__title"><span>{{ tariff.speed }}</span></div>
                          <div class="d-flex align-center">
                            <div class="rt-tariff-option__desc">Безлимитный интернет</div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- ТВ -->
                  <div class="rt-tariff__offer">
                    <div class="{% if tariff.interactive_tv %}enabled{% else %}disabled{% endif %} Basic_channel_packages">
                      <div class="rt-tariff-option {% if not tariff.interactive_tv %}is--disabled{% endif %}">
                        <i class="rt-tariff-option__icon">
                          <svg class="rt-sys-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" d="M5 4.5h14A1.5 1.5 0 0120.5 6v9a1.5 1.5 0 01-1.5 1.5H5A1.5 1.5 0 013.5 15V6A1.5 1.5 0 015 4.5zM2 6a3 3 0 013-3h14a3 3 0 013 3v9a3 3 0 01-3 3h-6.25v1.5H16V21H8v-1.5h3.25V18H5a3 3 0 01-3-3V6zm7.278 2.498h1.995v-.896H6.198v.896h1.977V14h1.103V8.498zm6.79-.896l-1.626 5.005-1.608-5.005h-1.218L13.91 14h1.077l2.303-6.398h-1.222z" clip-rule="evenodd"></path>
                          </svg>
                        </i>
                        <div class="rt-tariff-option__info">
                          <div class="rt-tariff-option__title">
                            <span>{% if tariff.interactive_tv %}223 канала{% else %}Не включено{% endif %}</span>
                          </div>
                          <div class="d-flex align-center">
                            <div class="rt-tariff-option__desc">Интерактивное ТВ Wink</div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Кинотеатр -->
                  <div class="rt-tariff__offer">
                    <div class="{% if tariff.online_cinema %}enabled{% else %}disabled{% endif %} ONLINE_CINEMA">
                      <div class="rt-tariff-option {% if not tariff.online_cinema %}is--disabled{% endif %}">
                        <i class="rt-tariff-option__icon">
                          <svg class="rt-sys-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" d="M11.477 12l-1.025 1.049-3.553 3.632 3.312 3.389 7.89-8.07-7.89-8.07L6.9 7.317l3.553 3.634 1.025 1.05zM9.38 12l-4.236 4.332a.5.5 0 000 .699l4.711 4.819a.5.5 0 00.715 0l9.289-9.5a.5.5 0 000-.7l-9.289-9.5a.5.5 0 00-.715 0L5.143 6.968a.5.5 0 000 .699L9.378 12z" clip-rule="evenodd"></path>
                          </svg>
                        </i>
                        <div class="rt-tariff-option__info">
                          <div class="rt-tariff-option__title">
                            <span>{% if tariff.online_cinema %}27 000 фильмов и сериалов{% else %}Не включено{% endif %}</span>
                          </div>
                          <div class="d-flex align-center wink-desc">
                            <div class="rt-tariff-option__desc">Онлайн-кинотеатр Wink</div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Мобильная связь -->
                  <div class="rt-tariff__offer">
                    <div class="enabled SIM-card_main">
                      <div class="rt-tariff-option">
                        <i class="rt-tariff-option__icon">
                          <svg class="rt-sys-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" d="M9 4.5h6A1.5 1.5 0 0116.5 6v12a1.5 1.5 0 01-1.5 1.5H9A1.5 1.5 0 017.5 18V6A1.5 1.5 0 019 4.5zM6 6a3 3 0 013-3h6a3 3 0 013 3v12a3 3 0 01-3 3H9a3 3 0 01-3-3V6zm8 10.5h-4V18h4v-1.5z" clip-rule="evenodd"></path>
                          </svg>
                        </i>
                        <div class="rt-tariff-option__info">
                          <div class="rt-tariff-option__title">
                            <span>
                              <span class="d-inline-block">{{ tariff.mobile_data }}&nbsp;Гб</span>/
                              <span class="d-inline-block">{{ tariff.mobile_minutes }}&nbsp;мин</span>/
                              <span class="d-inline-block">{{ tariff.mobile_sms }}&nbsp;СМС</span>
                            </span>
                          </div>
                          <div class="d-flex align-center">
                            <div class="rt-tariff-option__desc">Мобильная связь</div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="rt-tariff__line"></div>

                <div class="rt-tariff-footer">
                  <div class="price-comp">
                    <div class="rt-price-v3">
                      <div class="rt-price-v3__val">{{ tariff.price }}</div>
                      <div class="rt-price-v3__details">
                        <div class="rt-price-v3__currency">₽</div>
                        <div class="rt-price-v3__sep">/</div>
                        <div class="rt-price-v3__timeinterval">мес</div>
                      </div>
                    </div>
                  </div>

                  <button class="rt-button rt-button-orange" data-tariff="{{ tariff.id }}">
                    Подключить
                  </button>

                  <div class="card-details">
                    <a class="card-details__link">Настроить тариф</a>
                  </div>
                </div>
              </div>
              <div class="card-shadow"></div>
              <div class="card-bg"></div>
            </div>
          </div>
          {% endwith %}
          {% endfor %}
        </div>
      </div>

      <!-- Навигация карусели -->
      <div class="rt-carousel-nav">
        <button class="rt-carousel-prev" aria-label="Предыдущие тарифы">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>

        <div class="rt-carousel-dots"></div>

        <button class="rt-carousel-next" aria-label="Следующие тарифы">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
    </div>

  </div>
</section>

<section id="connect-form">
  <div class="container">
    <h2 class="section-title">Оставить заявку на подключение</h2>
    <div class="lead-card fade-in">
      <div class="form-header">
        <i class="fas fa-headset"></i>
        <h3>Подключите интернет от Ростелекома</h3>
        <p>Официальный дилер. Гарантия качества</p>
      </div>

      <form id="lead-form" action="{% url 'create_lead' %}" method="post">
        {% csrf_token %}

        <div class="form-group">
          <label for="fio"><i class="fas fa-user"></i> ФИО</label>
          <input type="text" id="fio" name="fio" placeholder="Иванов Иван Иванович" required>
        </div>

        <div class="form-group">
          <label for="phone"><i class="fas fa-phone"></i> Телефон</label>
          <input type="tel" id="phone" name="phone" placeholder="+7 (999) 999-99-99" required>
        </div>

        <div class="form-group">
          <label for="address"><i class="fas fa-map-marker-alt"></i> Адрес подключения</label>
          <input type="text" id="address" name="address" placeholder="ул. Примерная, д. 1, кв. 1" required>
        </div>

        <div class="form-group">
          <label for="tariff-select"><i class="fas fa-wifi"></i> Выберите тариф</label>
          <select name="tariff" id="tariff-select" required>
            <option value="">Выберите тариф</option>
            {% for tariff in tariffs %}
              <option value="{{ tariff.id }}" data-region="{{ tariff.region.id }}">
                {{ tariff.name }} - {{ tariff.speed|default:"Скорость не указана" }} - {{ tariff.price }} ₽/мес
              </option>
            {% endfor %}
          </select>
        </div>

        <input type="hidden" name="region" id="region-input" value="{% if current_region %}{{ current_region.name }}{% endif %}">

        <button type="submit" class="btn">
          <i class="fas fa-paper-plane"></i> Отправить заявку
        </button>

        <div id="lead-status"></div>
      </form>
    </div>
  </div>
</section>

<footer>
  <div class="container">
    <div class="footer-content">
      <div class="footer-section">
        <div class="footer-logo">
          <div class="logo">
            <img src="{% static 'tariffs/images/logos/logo-purple.svg' %}" alt="Ростелеком" class="rt-logo">
          </div>
        </div>
        <p>Официальный дилер ПАО «Ростелеком». Предоставляем качественные интернет-услуги с 2015 года.</p>
      </div>

      <div class="footer-section">
        <h4>Контакты</h4>
        <ul class="contact-info">
          <li><i class="fas fa-phone"></i> +7 (800) 123-45-67</li>
          <li><i class="fas fa-envelope"></i> info@rt-internet.ru</li>
          <li><i class="fas fa-map-marker-alt"></i> г. Москва, ул. Примерная, 1</li>
        </ul>
      </div>

      <div class="footer-section">
        <h4>Мы в соцсетях</h4>
        <div class="social-links">
          <a href="#"><i class="fab fa-vk"></i></a>
          <a href="#"><i class="fab fa-telegram"></i></a>
          <a href="#"><i class="fab fa-youtube"></i></a>
          <a href="#"><i class="fab fa-instagram"></i></a>
        </div>
      </div>
    </div>

    <div class="legal-info">
      <p>© 2025 ПАО «Ростелеком». Все права защищены.</p>
      <p>Услуги предоставляются официальными дилерами Ростелекома.</p>
    </div>
  </div>
</footer>

<script src="{% static 'tariffs/js/script.js' %}"></script>
<script>
// Исправленная функция инициализации карусели
function initCarousel() {
    const carousel = document.getElementById('rt-tariff-carousel');
    if (!carousel) return;

    const items = carousel.querySelectorAll('.rt-carousel-item');
    const prevBtn = document.querySelector('.rt-carousel-prev');
    const nextBtn = document.querySelector('.rt-carousel-next');
    const dotsContainer = document.querySelector('.rt-carousel-dots');
    const wrapper = document.querySelector('.rt-carousel-wrapper');

    if (items.length === 0) return;

    let currentIndex = 0;
    let itemsPerView = 3;
    let totalSlides = Math.ceil(items.length / itemsPerView);
    let isAnimating = false;

    // Определяем количество видимых элементов
    function updateItemsPerView() {
        if (window.innerWidth < 768) {
            itemsPerView = 1;
        } else if (window.innerWidth < 1200) {
            itemsPerView = 2;
        } else {
            itemsPerView = 3;
        }
        totalSlides = Math.ceil(items.length / itemsPerView);

        // Сбрасываем позицию карусели
        currentIndex = 0;
        updateCarousel();
        createDots();
        updateButtons();
    }

    // Создаем точки навигации
    function createDots() {
        if (!dotsContainer) return;

        dotsContainer.innerHTML = '';

        for (let i = 0; i < totalSlides; i++) {
            const dot = document.createElement('button');
            dot.className = 'rt-carousel-dot';
            dot.setAttribute('aria-label', `Перейти к слайду ${i + 1}`);
            if (i === 0) dot.classList.add('active');
            dot.addEventListener('click', () => goToSlide(i));
            dotsContainer.appendChild(dot);
        }
    }

    // Обновляем активную точку
    function updateDots() {
        const dots = dotsContainer.querySelectorAll('.rt-carousel-dot');
        dots.forEach((dot, index) => {
            dot.classList.toggle('active', index === currentIndex);
        });
    }

    // Обновляем состояние кнопок
    function updateButtons() {
        if (!prevBtn || !nextBtn) return;

        prevBtn.disabled = currentIndex === 0;
        nextBtn.disabled = currentIndex === totalSlides - 1;

        if (prevBtn.disabled) {
            prevBtn.setAttribute('disabled', 'true');
            prevBtn.setAttribute('aria-disabled', 'true');
        } else {
            prevBtn.removeAttribute('disabled');
            prevBtn.setAttribute('aria-disabled', 'false');
        }

        if (nextBtn.disabled) {
            nextBtn.setAttribute('disabled', 'true');
            nextBtn.setAttribute('aria-disabled', 'true');
        } else {
            nextBtn.removeAttribute('disabled');
            nextBtn.setAttribute('aria-disabled', 'false');
        }
    }

    // Перемещаем карусель
    function updateCarousel() {
        if (isAnimating) return;

        isAnimating = true;

        // Рассчитываем правильное смещение
        const itemWidth = items[0].offsetWidth + 20; // width + margin
        const wrapperWidth = wrapper.offsetWidth;
        const contentWidth = items.length * itemWidth;
        const maxOffset = Math.max(0, contentWidth - wrapperWidth);
        const translateX = Math.min(maxOffset, -currentIndex * itemsPerView * itemWidth);

        carousel.style.transition = 'transform 0.4s ease';
        carousel.style.transform = `translateX(${translateX}px)`;

        updateDots();
        updateButtons();

        // Сбрасываем флаг анимации после завершения
        setTimeout(() => {
            isAnimating = false;
        }, 400);
    }

    // Переход к слайду
    function goToSlide(index) {
        if (isAnimating) return;

        currentIndex = Math.max(0, Math.min(index, totalSlides - 1));
        updateCarousel();
    }

    // Следующий слайд
    function nextSlide() {
        if (currentIndex < totalSlides - 1 && !isAnimating) {
            currentIndex++;
            updateCarousel();
        }
    }

    // Предыдущий слайд
    function prevSlide() {
        if (currentIndex > 0 && !isAnimating) {
            currentIndex--;
            updateCarousel();
        }
    }

    // Инициализация
    updateItemsPerView();

    // Обработчики событий
    if (prevBtn) {
        prevBtn.addEventListener('click', prevSlide);
    }

    if (nextBtn) {
        nextBtn.addEventListener('click', nextSlide);
    }

    // Ресайз с debounce
    let resizeTimeout;
    window.addEventListener('resize', () => {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(() => {
            updateItemsPerView();
        }, 250);
    });

    // Swipe для мобильных
    let touchStartX = 0;
    let touchEndX = 0;

    wrapper.addEventListener('touchstart', (e) => {
        touchStartX = e.touches[0].clientX;
    }, { passive: true });

    wrapper.addEventListener('touchend', (e) => {
        touchEndX = e.changedTouches[0].clientX;
        handleSwipe();
    }, { passive: true });

    function handleSwipe() {
        if (isAnimating) return;

        const swipeThreshold = 50;
        const diff = touchStartX - touchEndX;

        if (Math.abs(diff) > swipeThreshold) {
            if (diff > 0) {
                nextSlide();
            } else {
                prevSlide();
            }
        }
    }
}

// Инициализация при загрузке
document.addEventListener('DOMContentLoaded', function() {
    initCarousel();
});
</script>
</body>
</html>